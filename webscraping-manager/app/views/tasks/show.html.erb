<div style="max-width: 800px; margin: 0 auto;">
  <div style="margin-bottom: 1rem;">
    <%= link_to "&larr; Back to Dashboard".html_safe, tasks_path, style: "color: var(--text-muted); text-decoration: none;" %>
  </div>

  <div class="card">
    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1.5rem;">
      <div>
        <h1 style="margin: 0; font-size: 1.5rem;">Task #<%= @task.id %></h1>
        <p style="color: var(--text-muted); margin: 0.25rem 0 0 0;">
          Created <%= @task.created_at.strftime("%b %d, %Y %H:%M") %>
        </p>
      </div>
      <span style="
        padding: 0.5rem 1rem; 
        border-radius: 9999px; 
        font-weight: 600;
        background: <%= @task.status == 'completed' ? '#dcfce7' : (@task.status == 'failed' ? '#fee2e2' : '#e0e7ff') %>;
        color: <%= @task.status == 'completed' ? '#166534' : (@task.status == 'failed' ? '#991b1b' : '#3730a3') %>;
      ">
        <%= @task.status.upcase %>
      </span>
    </div>

    <div style="background: #f8fafc; padding: 1rem; border-radius: 0.375rem; margin-bottom: 1.5rem; word-break: break-all;">
      <span style="font-weight: 600; font-size: 0.875rem; display: block; margin-bottom: 0.25rem;">Target URL</span>
      <a href="<%= @task.url %>" target="_blank" style="color: var(--primary);"><%= @task.url %></a>
    </div>

    <% if @task.status == 'completed' && @task.result.present? %>
      <h2 style="font-size: 1.25rem; border-bottom: 1px solid var(--border); padding-bottom: 0.5rem; margin-bottom: 1rem;">Scraped Data</h2>
      
      <% result = JSON.parse(@task.result) rescue {} %>
      
      <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
        <div>
          <label style="display: block; font-size: 0.875rem; color: var(--text-muted);">Brand</label>
          <div style="font-size: 1.125rem; font-weight: 500;"><%= result["brand"] %></div>
        </div>
        <div>
          <label style="display: block; font-size: 0.875rem; color: var(--text-muted);">Model</label>
          <div style="font-size: 1.125rem; font-weight: 500;"><%= result["model"] %></div>
        </div>
        <div>
          <label style="display: block; font-size: 0.875rem; color: var(--text-muted);">Price</label>
          <div style="font-size: 1.125rem; font-weight: 500; color: var(--success);"><%= result["price"] %></div>
        </div>
        <div>
          <label style="display: block; font-size: 0.875rem; color: var(--text-muted);">Description</label>
          <div style="font-size: 1rem;"><%= result["description"] %></div>
        </div>
      </div>

    <% elsif @task.status == 'failed' %>
      <div class="alert alert-alert">
        <strong>Error:</strong> <%= @task.error_message || "Unknown error occurred" %>
      </div>
    <% else %>
      <div style="text-align: center; padding: 2rem; color: var(--text-muted);">
        <p>This task is currently <%= @task.status %>. Refresh page to check updates.</p>
      </div>
    <% end %>
    
    <div style="margin-top: 2rem; border-top: 1px solid var(--border); padding-top: 1rem; display: flex; justify_content: flex-end;">
      <%= button_to "Delete Task", task_path(@task), method: :delete, class: "btn btn-danger", form: { style: "display:inline-block;" }, onclick: "return confirm('Are you sure?')" %>
    </div>
  </div>
</div>
